{% extends "base.html" %}
{% block content %}

<h2>Secrets</h2>
<p>
<div id="table"></div>
</p>

<script>
    function convertArray (value) {
     return new TextDecoder().decode(value);
    };

    const secretsLabels = {
        id: "#",
        target_name: "Target",
        share_name: "Share",
        path: "Path",
        line: "Full line",
        secret: "Secret",
        content_hash: {
          name: "Content",
          formatter: x => gridjs.html(`<a href="content/${convertArray(x)}" target="_blank">Open</a>`),
        },
    };
    async function main(){
        const db = await initDb();
        const rows = db.exec(queries.secrets_with_paths)[0];
        const columns = rows.columns.map(col => {
            if (secretsLabels[col]) { return secretsLabels[col] }
            else { return col }
        });

        new gridjs.Grid({
            columns: columns,
            data: rows.values,
            style: {td: {'font-family': "monospace"}},
            pagination: {limit: 20},
            search: true,
            sort: true,
            resizable: true,
        }).render(document.getElementById("table"));
    };
    window.addEventListener("load", main);
</script>

{% endblock %}
